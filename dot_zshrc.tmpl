# === STARSHIP AUTOMATIC INSTALLATION ===
# Ensures Starship is present in every environment (Mac, Linux, DevPod)
if ! command -v starship &> /dev/null; then
    echo "üöÄ Starship not found. Installing..."
    if [[ "$OSTYPE" == "darwin"* ]]; then
        brew install starship &> /dev/null || curl -sS https://starship.rs/install.sh | sh -s -- -y
    else
        # For Linux/DevPod - installs to /usr/local/bin by default
        curl -sS https://starship.rs/install.sh | sh -s -- -y
    fi
fi

# Init Starship prompt
eval "$(starship init zsh)"

# === UNIVERSAL SETTINGS ===
alias ll="ls -la"
alias ..="cd .."

# === DEVPOD FUNCTIONS ===
# Pilna DevSecOps aplinka: Cloud CLIs, IaC, Kubernetes ir Saugumo ƒØrankiai
devon() {
    mkdir -p .devcontainer
    echo '{
    "name": "Full DevSecOps & Security Environment",
    "image": "mcr.microsoft.com/devcontainers/universal:latest",
    "features": {
        "ghcr.io/devcontainers/features/common-utils:1": {
            "configureZshAsDefaultShell": true
        },
        "ghcr.io/devcontainers/features/terraform:1": {},
        "ghcr.io/devcontainers/features/kubectl-helm-minikube:1": {},
        "ghcr.io/devcontainers/features/aws-cli:1": {},
        "ghcr.io/devcontainers/features/azure-cli:1": {},
        "ghcr.io/devcontainers/features/docker-in-docker:1": {},
        "ghcr.io/devcontainers-contrib/features/trivy:2": {},
        "ghcr.io/devcontainers-contrib/features/snyk-cli:2": {}
    },
    "customizations": {
        "vscode": {
            "settings": {
                "terminal.integrated.fontFamily": "JetBrainsMono Nerd Font"
            },
            "extensions": [
                "ms-azuretools.vscode-docker",
                "ms-kubernetes-tools.vscode-kubernetes-tools",
                "hashicorp.terraform",
                "redhat.ansible",
                "amazonwebservices.aws-toolkit-vscode",
                "ms-vscode.azurecli",
                "snyk-security.snyk-vscode",
                "knqyf263.trivy-vulnerability-scanner"
            ]
        }
    },
    "postCreateCommand": "sh -c \"curl -sS https://webinstall.dev/k9s | bash && curl -sS https://dl.min.io/client/mc/release/linux-amd64/mc -o /usr/local/bin/mc && chmod +x /usr/local/bin/mc\""
}' > .devcontainer/devcontainer.json
    echo "‚úÖ DevSecOps paruo≈°tas: Pridƒóti Trivy ir Snyk saugumo ƒØrankiai"
}

# Deletes devcontainer config to keep the project clean
devoff() {
    rm -rf .devcontainer
    echo "üóëÔ∏è   .devcontainer removed"
}

# === GIT CONFIGURATION ===
# Automatically sets the global ignore file
git config --global core.excludesfile ~/.gitignore_global

# Manual alias to resync git global ignore settings
alias gsync="git config --global core.excludesfile ~/.gitignore_global && echo '‚úÖ Git global ignore synced'"

# Pushes all chezmoi changes to GitHub with one command
alias dpush="cd \$(chezmoi source-path) && git add . && git commit -m 'update' && git push && cd -"

# === DEVPOD TERMINAL COMMANDS ===
# Quickly spin up the current folder in DevPod using your SSH provider
alias dup="devpod up . --provider ssh"
alias dls="devpod list"
alias dstop="devpod stop"
alias dclean="devpod list | grep 'Exited' | awk '{print \$1}' | xargs -r devpod delete"

# Combined command: prepares environment AND starts DevPod
devup() {
    devon
    devpod up . --provider ssh
}

# === MAC SPECIFIC SETTINGS ===
{{- if eq .chezmoi.os "darwin" }}
# Antigravity & AI settings
export PATH="/Users/user/.antigravity/antigravity/bin:$PATH"
export PATH="/path/to/gemini-cli:$PATH"

# Google Cloud SDK
if [ -f '/Users/user/Downloads/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/user/Downloads/google-cloud-sdk/path.zsh.inc'; fi
if [ -f '/Users/user/Downloads/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/user/Downloads/google-cloud-sdk/completion.zsh.inc'; fi
{{- end }}

# === LINUX / DEVPOD SPECIFIC SETTINGS ===
{{- if eq .chezmoi.os "linux" }}
# Add specific Linux server tweaks here
{{- end }}
