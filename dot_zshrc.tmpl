# === STARSHIP AUTOMATIC INSTALLATION ===
# Ensures Starship is present in every environment (Mac, Linux, DevPod)
if ! command -v starship &> /dev/null; then
    echo "üöÄ Starship not found. Installing..."
    if [[ "$OSTYPE" == "darwin"* ]]; then
        brew install starship &> /dev/null || curl -sS https://starship.rs/install.sh | sh -s -- -y
    else
        # For Linux/DevPod - installs to /usr/local/bin by default
        curl -sS https://starship.rs/install.sh | sh -s -- -y
    fi
fi

# Init Starship prompt
eval "$(starship init zsh)"

# === UNIVERSAL SETTINGS ===
alias ll="ls -la"
alias ..="cd .."

# === DEVPOD FUNCTIONS ===
# Creates a universal Microsoft devcontainer config with font support
devon() {
    mkdir -p .devcontainer
    echo '{
    "name": "Mano Universal Aplinka",
    "image": "mcr.microsoft.com/devcontainers/universal:latest",
    "features": {
        "ghcr.io/devcontainers/features/common-utils:1": {
            "configureZshAsDefaultShell": true
        }
    },
    "customizations": {
        "vscode": {
            "settings": {
                "terminal.integrated.fontFamily": "JetBrainsMono Nerd Font"
            }
        }
    }
}' > .devcontainer/devcontainer.json
    echo "‚úÖ .devcontainer ready with auto-font configuration"
}

# Deletes devcontainer config to keep the project clean
devoff() {
    rm -rf .devcontainer
    echo "üóëÔ∏è   .devcontainer removed"
}

# === GIT CONFIGURATION ===
# Automatically sets the global ignore file
git config --global core.excludesfile ~/.gitignore_global

# Manual alias to resync git global ignore settings
alias gsync="git config --global core.excludesfile ~/.gitignore_global && echo '‚úÖ Git global ignore synced'"

# Pushes all chezmoi changes to GitHub with one command
alias dpush="cd \$(chezmoi source-path) && git add . && git commit -m 'update' && git push && cd -"

# === DEVPOD TERMINAL COMMANDS ===
# Quickly spin up the current folder in DevPod using your SSH provider
alias dup="devpod up . --provider ssh"
alias dls="devpod list"
alias dstop="devpod stop"
alias dclean="devpod list | grep 'Exited' | awk '{print \$1}' | xargs -r devpod delete"

# Combined command: prepares environment AND starts DevPod
devup() {
    devon
    devpod up . --provider ssh
}

# === MAC SPECIFIC SETTINGS ===
{{- if eq .chezmoi.os "darwin" }}
# Antigravity & AI settings
export PATH="/Users/user/.antigravity/antigravity/bin:$PATH"
export PATH="/path/to/gemini-cli:$PATH"

# Google Cloud SDK
if [ -f '/Users/user/Downloads/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/user/Downloads/google-cloud-sdk/path.zsh.inc'; fi
if [ -f '/Users/user/Downloads/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/user/Downloads/google-cloud-sdk/completion.zsh.inc'; fi
{{- end }}

# === LINUX / DEVPOD SPECIFIC SETTINGS ===
{{- if eq .chezmoi.os "linux" }}
# Add specific Linux server tweaks here
{{- end }}
