# === STARSHIP AUTOMATIC INSTALLATION ===
# Checks if starship is installed, if not - installs it automatically
if ! command -v starship &> /dev/null; then
    echo "üöÄ Starship not found. Installing..."
    if [[ "$OSTYPE" == "darwin"* ]]; then
        # For MacBook Pro
        brew install starship &> /dev/null || curl -sS https://starship.rs/install.sh | sh -s -- -y
    else
        # For Linux / DevPod / LXC
        curl -sS https://starship.rs/install.sh | sh -s -- -y
    fi
fi

# Init Starship prompt
eval "$(starship init zsh)"

# === UNIVERSAL SETTINGS ===
alias ll="ls -la"
alias ..="cd .."

# === DEVPOD FUNCTIONS ===
# Creates a universal Microsoft devcontainer config
devon() {
    mkdir -p .devcontainer
    echo '{
    "name": "My Universal Environment",
    "image": "mcr.microsoft.com/devcontainers/universal:latest"
}' > .devcontainer/devcontainer.json
    echo "‚úÖ .devcontainer ready (ignored by git)"
}

# Deletes devcontainer config to keep the project clean
devoff() {
    rm -rf .devcontainer
    echo "üóëÔ∏è   .devcontainer removed"
}

# === GIT CONFIGURATION ===
# Automatically sets the global ignore file to ensure .devcontainer is never committed
git config --global core.excludesfile ~/.gitignore_global

# Manual alias to resync git global ignore settings
alias gsync="git config --global core.excludesfile ~/.gitignore_global && echo '‚úÖ Git global ignore synced'"

# Deletes all stopped DevPod workspaces to free up space on server (192.168.30.9)
alias dclean="devpod list | grep 'Exited' | awk '{print \$1}' | xargs -r devpod delete"

# Pushes all chezmoi changes to GitHub with one command
alias dpush="cd \$(chezmoi source-path) && git add . && git commit -m 'update' && git push && cd -"

# === DEVPOD TERMINAL COMMANDS ===
# Quickly spin up the current folder in DevPod using your SSH provider
alias dup="devpod up . --provider ssh"

# List all running workspaces
alias dls="devpod list"

# Stop the current workspace (saves resources on server)
alias dstop="devpod stop"

# Combined command: prepares environment AND starts DevPod
devup() {
    devon
    devpod up . --provider ssh
}

# === MAC SPECIFIC SETTINGS ===
{{- if eq .chezmoi.os "darwin" }}
# Antigravity settings
export PATH="/Users/user/.antigravity/antigravity/bin:$PATH"
export PATH="/path/to/gemini-cli:$PATH"

# Google Cloud SDK (Mac only)
if [ -f '/Users/user/Downloads/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/user/Downloads/google-cloud-sdk/path.zsh.inc'; fi
if [ -f '/Users/user/Downloads/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/user/Downloads/google-cloud-sdk/completion.zsh.inc'; fi
{{- end }}

# === LINUX / DEVPOD SPECIFIC SETTINGS ===
{{- if eq .chezmoi.os "linux" }}
# Specific settings for LXC (192.168.30.9) or DevPod containers
{{- end }}
